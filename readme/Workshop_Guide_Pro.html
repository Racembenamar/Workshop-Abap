<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAP Workshop</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --primary: #0065e0;
            /* SAP Blue-ish */
            --primary-dark: #0049a3;
            --text: #1a202c;
            --text-light: #4a5568;
            --bg: #ffffff;
            --sidebar-bg: #f7fafc;
            --border: #e2e8f0;
            --code-bg: #1a202c;
            --code-text: #e2e8f0;
            --success: #48bb78;
            --warning: #ed8936;
        }

        body {
            font-family: 'Inter', sans-serif;
            color: var(--text);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Sidebar */
        aside {
            width: 300px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .brand {
            padding: 24px;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .brand svg {
            width: 24px;
            height: 24px;
        }

        nav {
            flex: 1;
            overflow-y: auto;
            padding: 20px 0;
        }

        .nav-group {
            margin-bottom: 24px;
        }

        .nav-header {
            padding: 0 24px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-light);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .nav-item {
            display: block;
            padding: 8px 24px;
            color: var(--text);
            text-decoration: none;
            font-size: 0.95rem;
            border-left: 3px solid transparent;
            transition: all 0.2s;
            cursor: pointer;
        }

        .nav-item:hover {
            background: #edf2f7;
            color: var(--primary);
        }

        .nav-item.active {
            border-left-color: var(--primary);
            background: #ebf8ff;
            color: var(--primary-dark);
            font-weight: 500;
        }

        /* Main Content */
        main {
            flex: 1;
            overflow-y: auto;
            scroll-behavior: smooth;
            padding: 0;
            position: relative;
        }

        .content-wrapper {
            max-width: 800px;
            margin: 0 auto;
            padding: 60px 40px 100px;
        }

        header {
            margin-bottom: 40px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 20px;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 0 0 10px 0;
            letter-spacing: -0.02em;
        }

        h2 {
            font-size: 1.75rem;
            margin-top: 3rem;
            margin-bottom: 1.5rem;
            color: var(--text);
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }

        h3 {
            font-size: 1.25rem;
            margin-top: 2rem;
            margin-bottom: 0.75rem;
            color: var(--text);
        }

        p {
            line-height: 1.7;
            color: var(--text-light);
            margin-bottom: 1.5rem;
        }

        /* Code Blocks */
        pre {
            background: var(--code-bg);
            color: var(--code-text);
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            margin: 1.5rem 0;
            position: relative;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        code {
            font-family: 'JetBrains Mono', monospace;
            background: #edf2f7;
            color: var(--primary-dark);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        pre code {
            background: transparent;
            color: inherit;
            padding: 0;
        }

        /* Components */
        .step-card {
            background: #fff;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .step-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .step-number {
            display: inline-block;
            background: var(--primary);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            text-align: center;
            line-height: 28px;
            font-weight: 600;
            font-size: 0.9rem;
            margin-right: 10px;
        }

        .step-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--text);
        }

        .callout {
            background: #ebf8ff;
            border-left: 4px solid var(--primary);
            padding: 16px 20px;
            border-radius: 0 4px 4px 0;
            margin: 20px 0;
        }

        .callout.warning {
            background: #fffaf0;
            border-left-color: var(--warning);
        }

        .callout-title {
            font-weight: 600;
            display: block;
            margin-bottom: 8px;
            color: var(--primary-dark);
        }

        .callout.warning .callout-title {
            color: #c05621;
        }

        .concept-box {
            background: #f0fff4;
            border: 1px solid #c6f6d5;
            border-radius: 8px;
            padding: 24px;
            margin: 30px 0;
        }

        .concept-title {
            color: #276749;
            font-weight: 700;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Syntax Highlighting Simulation */
        .kwd {
            color: #ff79c6;
        }

        /* Keyword */
        .str {
            color: #f1fa8c;
        }

        /* String */
        .com {
            color: #6272a4;
            font-style: italic;
        }

        /* Comment */
        .typ {
            color: #8be9fd;
        }

        /* Type */
        .fun {
            color: #50fa7b;
        }

        /* Function */
    </style>
</head>

<body>

    <aside>
        <div class="brand">
            <svg viewBox="0 0 24 24" fill="currentColor">
                <path
                    d="M12 2L2 7l10 5 10-5-10-5zm0 9l2.5-1.25L12 8.5l-2.5 1.25L12 11zm0 2.5l-5-2.5-5 2.5L12 22l10-8.5-5-2.5-5 2.5z" />
            </svg>
            RAP Workshop
        </div>
        <nav>
            <div class="nav-group">
                <div class="nav-header">Module 1: Foundation</div>
                <a href="#intro" class="nav-item active">Introduction</a>
                <a href="#data-model" class="nav-item">1. The Data Model</a>
                <a href="#service" class="nav-item">2. Service & Binding</a>
            </div>
            <div class="nav-group">
                <div class="nav-header">Module 2: User Interface</div>
                <a href="#ui-annotations" class="nav-item">3. UI Annotations</a>
                <a href="#facets" class="nav-item">4. Page Layout (Facets)</a>
            </div>
            <div class="nav-group">
                <div class="nav-header">Module 3: Behavior</div>
                <a href="#crud" class="nav-item">5. Enabling CRUD</a>
                <a href="#drafts" class="nav-item">6. Draft Capabilities</a>
            </div>
            <div class="nav-group">
                <div class="nav-header">Module 4: Logic</div>
                <a href="#automation" class="nav-item">7. Automation (Early Numbering)</a>
                <a href="#rules" class="nav-item">8. Business Rules</a>
                <a href="#actions" class="nav-item">9. Custom Actions</a>
            </div>
            <div class="nav-group">
                <div class="nav-header">Module 5: UX</div>
                <a href="#value-help" class="nav-item">10. Value Help</a>
            </div>
            <div class="nav-group">
                <div class="nav-header">Module 6: Conclusion</div>
                <a href="#final-solution" class="nav-item">11. Final Solution</a>
            </div>
        </nav>
    </aside>

    <main>
        <div class="content-wrapper">

            <section id="intro">
                <header>
                    <h1>Building a Product Manager App</h1>
                    <p>Welcome to the RAP Workshop. In this workshop, you will build a modern, cloud-ready enterprise
                        application using the ABAP RESTful Application Programming Model (RAP). By the end, you will
                        have a fully functional Fiori app with draft capabilities, validations, and custom logic.</p>
                </header>
            </section>

            <section id="data-model">
                <h2>1. The Data Model</h2>
                <p>Every application starts with data. We will define a <strong>CDS View Entity</strong> to fetch
                    product information from the database.</p>

                <div class="step-card">
                    <div class="step-title"><span class="step-number">1</span> Create Data Definition</div>
                    <p>Create a new Data Definition named <code>ZIW_Products</code>. Ensure you select from the demo
                        table <code>zproduct_demo</code> to access all required fields.</p>
                    <pre><code><span class="kwd">define root view entity</span> ZIW_Products
  <span class="kwd">as select from</span> zproduct_demo
{
  <span class="kwd">key</span> product_id,
      prd_name,
      prd_price,
      prd_currency
      <span class="com">// We will add more fields later when needed!</span>
}</code></pre>
                </div>
            </section>

            <section id="service">
                <h2>2. Service Definition & Binding</h2>
                <p>To make our data accessible to the web (Fiori), we need to expose it as an OData service.</p>

                <div class="step-card">
                    <div class="step-title"><span class="step-number">2</span> Define Service</div>
                    <p>Create a Service Definition <code>Zui_products</code> and expose your view.</p>
                    <pre><code><span class="kwd">define service</span> Zui_products {
  <span class="kwd">expose</span> ZIW_Products;
}</code></pre>
                </div>

                <div class="step-card">
                    <div class="step-title"><span class="step-number">3</span> Bind & Publish</div>
                    <p>Right-click the Service Definition > <strong>New Service Binding</strong>. Choose <strong>OData
                            V4 - UI</strong>. Click <strong>Publish</strong>.</p>
                    <div class="callout">
                        <span class="callout-title">Check Point</span>
                        Click the <strong>Preview</strong> button. You should see a raw list of data. It won't look
                        pretty yet, but it proves the pipeline is working.
                    </div>
                </div>
            </section>

            <section id="ui-annotations">
                <h2>3. UI Annotations</h2>
                <p>Fiori Elements is metadata-driven. We don't write HTML; we add annotations to tell the UI what to
                    render.</p>

                <div class="step-card">
                    <div class="step-title"><span class="step-number">4</span> Add List & Form Annotations</div>
                    <p>Update <code>ZIW_Products</code> to define columns and form fields.</p>
                    <pre><code>  <span class="com">@UI.lineItem: [{ position: 10, label: 'Product ID' }]</span>
  <span class="com">@UI.identification: [{ position: 10, label: 'Product ID' }]</span>
  <span class="kwd">key</span> product_id,

  <span class="com">@UI.lineItem: [{ position: 20, label: 'Name' }]</span>
  <span class="com">@UI.identification: [{ position: 20, label: 'Name' }]</span>
  prd_name,</code></pre>
                </div>
            </section>

            <section id="facets">
                <h2>4. Page Layout (Facets)</h2>
                <div class="callout warning">
                    <span class="callout-title">Critical Concept</span>
                    If you only add <code>@UI.identification</code>, the Detail Page will be blank. You must define a
                    <strong>Facet</strong> to tell Fiori where to place those fields.
                </div>

                <div class="step-card">
                    <div class="step-title"><span class="step-number">5</span> Define the Facet</div>
                    <p>Add this annotation to the header of your CDS view:</p>
                    <pre><code><span class="com">@UI.facet: [ 
  { id: 'Detail', 
    purpose: #STANDARD, 
    type: #IDENTIFICATION_REFERENCE, 
    label: 'Product Detail', 
    position: 10 } 
]</span></code></pre>
                </div>
            </section>

            <section id="crud">
                <h2>5. Enabling CRUD</h2>
                <p>Now we make the app interactive. We need to define the <strong>Behavior</strong> of our object.</p>

                <div class="step-card">
                    <div class="step-title"><span class="step-number">6</span> Create Behavior Definition</div>
                    <p>Right-click CDS View > New Behavior Definition. Use the following structure:</p>
                    <pre><code><span class="kwd">managed</span>;
<span class="kwd">strict</span> ( 2 );

<span class="kwd">define behavior for</span> ZIW_Products
<span class="kwd">persistent table</span> zproduct_demo
<span class="kwd">lock master</span>
<span class="com">// We will add ETag later</span>
{
  <span class="kwd">create</span>;
  <span class="kwd">update</span>;
  <span class="kwd">delete</span>;
  
  <span class="kwd">field</span> ( readonly ) product_id;
}</code></pre>
                </div>
            </section>

            <section id="drafts">
                <h2>6. Draft Capabilities</h2>
                <p>Enterprise apps require "Drafts" so users don't lose unsaved work. Drafts and ETags work together to
                    ensure data consistency.</p>

                <div class="step-card">
                    <div class="step-title"><span class="step-number">7</span> Enable Drafts</div>

                    <div class="callout warning">
                        <span class="callout-title">Requirement: ETag & Locking</span>
                        To enable Drafts, we need a timestamp field for optimistic locking.
                        <br><strong>Action:</strong> Go back to your CDS View <code>ZIW_Products</code> and add:
                        <pre><code><span class="com">@Semantics.systemDateTime.lastChangedAt: true</span>
last_changed_at</code></pre>
                    </div>

                    <p>Now, update your BDEF to include draft handling and the ETag:</p>
                    <pre><code><span class="kwd">with draft</span>;

<span class="kwd">define behavior for</span> ZIW_Products
<span class="kwd">draft table</span> zproducts_draft
<span class="kwd">total etag</span> last_changed_at  <span class="com">// Add this!</span>
{
  <span class="kwd">field</span> ( readonly ) last_changed_at; <span class="com">// Add this!</span>

  <span class="kwd">draft action</span> Edit;
  <span class="kwd">draft action</span> Activate;
  <span class="kwd">draft action</span> Discard;
  <span class="kwd">draft action</span> Resume;
  <span class="kwd">draft determine action</span> Prepare {}
}</code></pre>
                    <p><em>Tip: Use <strong>Ctrl+1</strong> (Quick Fix) to generate the draft table
                            <code>zproducts_draft</code>.</em></p>
                </div>
            </section>

            <section id="automation">
                <h2>7. Automation (Early Numbering)</h2>
                <p>We want the system to generate the Product ID automatically when the user clicks "Create".</p>

                <div class="concept-box">
                    <div class="concept-title">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                        Deep Dive: Early Numbering
                    </div>
                    <p><strong>Early Numbering</strong> generates the ID <em>before</em> the final save. This is crucial
                        for Drafts because the draft needs a key to be stored.</p>
                    <p><strong>The Challenge:</strong> We must map the temporary ID (<code>%cid</code>) to the permanent
                        ID (<code>product_id</code>) AND tell the framework if it's a draft (<code>%is_draft</code>).
                    </p>
                </div>

                <div class="step-card">
                    <div class="step-title"><span class="step-number">8</span> Implement Logic</div>
                    <p>In your Behavior Class (<code>zbp_iw_products</code>), implement the
                        <code>early_numbering_create</code> method:</p>
                    <pre><code><span class="kwd">METHOD</span> early_numbering_create.
  <span class="kwd">SELECT MAX</span>( product_id ) <span class="kwd">FROM</span> zproduct_demo <span class="kwd">INTO @DATA</span>(max_id).

  <span class="kwd">LOOP AT</span> entities <span class="kwd">ASSIGNING FIELD-SYMBOL</span>(&lt;entity&gt;).
    max_id = max_id + 1.
    
    <span class="kwd">APPEND VALUE</span> #( %cid      = &lt;entity&gt;-%cid
                    %is_draft = &lt;entity&gt;-%is_draft <span class="com">" Critical!</span>
                    product_id = max_id ) <span class="kwd">TO</span> mapped-ziw_products.
  <span class="kwd">ENDLOOP</span>.
<span class="kwd">ENDMETHOD</span>.</code></pre>
                </div>
            </section>

            <section id="rules">
                <h2>8. Business Rules</h2>
                <p>Protect your data integrity with Validations (Checks) and Determinations (Auto-fill).</p>

                <div class="step-card">
                    <div class="step-title"><span class="step-number">9</span> Validation: Price Check</div>
                    <p>Ensure price is positive. Add <code>validation validatePrice on save ...</code> to BDEF, then
                        implement:</p>
                    <pre><code><span class="kwd">METHOD</span> validatePrice.
  <span class="kwd">READ ENTITIES OF</span> ZIW_Products <span class="kwd">IN LOCAL MODE</span>
    <span class="kwd">ENTITY</span> ZIW_Products
    <span class="kwd">FIELDS</span> ( prd_price ) <span class="kwd">WITH CORRESPONDING</span> #( keys )
    <span class="kwd">RESULT DATA</span>(products).

  <span class="kwd">LOOP AT</span> products <span class="kwd">INTO DATA</span>(product).
    <span class="kwd">IF</span> product-prd_price <= 0.
      <span class="kwd">APPEND VALUE</span> #( %tky = product-%tky ) <span class="kwd">TO</span> failed-ziw_products.
      <span class="kwd">APPEND VALUE</span> #( %tky = product-%tky
                      %msg = new_message_with_text( ... ) 
                    ) <span class="kwd">TO</span> reported-ziw_products.
    <span class="kwd">ENDIF</span>.
  <span class="kwd">ENDLOOP</span>.
<span class="kwd">ENDMETHOD</span>.</code></pre>
                </div>
            </section>

            <section id="actions">
                <h2>9. Custom Actions</h2>
                <p>Add a "10% Discount" button to the UI.</p>
                <div class="step-card">
                    <div class="step-title"><span class="step-number">10</span> Define & Implement Action</div>
                    <ol>
                        <li><strong>BDEF:</strong> <code>action applyDiscount result [1] $self;</code></li>
                        <li><strong>CDS:</strong>
                            <code>@UI.lineItem: [{ type: #FOR_ACTION, dataAction: 'applyDiscount', label: '10% Discount' }]</code>
                        </li>
                        <li><strong>Class:</strong> Implement logic using <code>READ</code> -> Calculate ->
                            <code>MODIFY</code>.</li>
                    </ol>
                </div>
            </section>

            <section id="value-help">
                <h2>10. Value Help</h2>
                <p>Provide a dropdown for the Currency field using the standard <code>I_Currency</code> view.</p>
                <div class="step-card">
                    <div class="step-title"><span class="step-number">11</span> Add Value Help</div>
                    <p>In <code>ZIW_Products</code> CDS view:</p>
                    <pre><code><span class="com">@Consumption.valueHelpDefinition: [{ entity: { name: 'I_Currency', element: 'Currency' } }]</span>
prd_currency</code></pre>
                    <p><strong>Important:</strong> Don't forget to <code>expose I_Currency</code> in your Service
                        Definition!</p>
                </div>
            </section>

            <section id="final-solution">
                <h2>11. Final Solution Code</h2>
                <p>Stuck? Here is the complete, working code for all components.</p>

                <div class="step-card">
                    <div class="step-title">1. Data Definition (CDS)</div>
                    <pre><code><span class="com">@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'ZIW_Products'
@Metadata.ignorePropagatedAnnotations: true
@Search.searchable: true   
@UI.headerInfo: { typeName: 'Product', title: { value: 'product_id' } }</span>

<span class="kwd">define root view entity</span> ZIW_Products
  <span class="kwd">as select from</span> zproduct_demo
{
      <span class="com">@UI.lineItem: [{ label: 'Product ID',position: 10 }]
      @UI.identification: [{ label: 'Product ID',position: 10 }]
      @UI.facet: [ 
                { 
                    id:              'Detail',
                    purpose:         #STANDARD,
                    type:            #IDENTIFICATION_REFERENCE,
                    label:           'Product Detail',
                    position:        10 
                 } 
              ] 
      @Search.defaultSearchElement: true</span>
      <span class="kwd">key</span> product_id,

      <span class="com">@Semantics.text: true
      @UI.lineItem: [{ label: 'Product Name',position: 20 }]
      @UI.identification: [{ label: 'Product Name',position: 20 }]</span>
      prd_name,
      
      <span class="com">@Semantics.amount.currencyCode: 'prd_currency'
      @UI.lineItem: [
          { label: 'Product Price', position: 30 },
          { type: #FOR_ACTION, dataAction: 'applyDiscount', label: '10% Discount', position: 10 }
      ]
      @UI.identification: [
          { label: 'Product Price', position: 30 },
          { type: #FOR_ACTION, dataAction: 'applyDiscount', label: '10% Discount', position: 10 }
      ]</span>
      prd_price,

      <span class="com">@Consumption.valueHelpDefinition: [{ entity: { name: 'I_Currency', element: 'Currency' } }]</span>
      prd_currency,
      
      <span class="com">@Semantics.systemDateTime.lastChangedAt: true</span>
      last_changed_at
}</code></pre>
                </div>

                <div class="step-card">
                    <div class="step-title">2. Behavior Definition (BDEF)</div>
                    <pre><code><span class="kwd">managed implementation in class</span> zbp_iw_products <span class="kwd">unique</span>;
<span class="kwd">strict</span> ( 2 );
<span class="kwd">with draft</span>;

<span class="kwd">define behavior for</span> ZIW_Products
<span class="kwd">persistent table</span> zproduct_demo
<span class="kwd">draft table</span> zproducts_draft
<span class="kwd">lock master total etag</span> last_changed_at
<span class="kwd">authorization master</span> ( global )
<span class="kwd">early numbering</span>
{
  <span class="kwd">create</span> ( authorization : global );
  <span class="kwd">update</span>;
  <span class="kwd">delete</span>;

  <span class="kwd">action</span> applyDiscount <span class="kwd">result</span> [1] $self;

  <span class="kwd">draft action</span> Edit;
  <span class="kwd">draft action</span> Resume;
  <span class="kwd">draft action</span> Activate;
  <span class="kwd">draft action</span> Discard;

  <span class="kwd">draft determine action</span> Prepare {
    <span class="kwd">validation</span> validatePrice;
  }

  <span class="kwd">field</span> ( readonly ) last_changed_at;
  <span class="kwd">field</span> ( readonly ) product_id;

  <span class="kwd">validation</span> validatePrice <span class="kwd">on save</span> { <span class="kwd">field</span> prd_price; <span class="kwd">create</span>; <span class="kwd">update</span>; }
  <span class="kwd">determination</span> setCurrency <span class="kwd">on modify</span> { <span class="kwd">field</span> prd_currency; <span class="kwd">create</span>; }
}</code></pre>
                </div>

                <div class="step-card">
                    <div class="step-title">3. Behavior Class (ABAP)</div>
                    <pre><code><span class="kwd">CLASS</span> lhc_ZIW_Products <span class="kwd">DEFINITION INHERITING FROM</span> cl_abap_behavior_handler.
  <span class="kwd">PRIVATE SECTION</span>.
    <span class="kwd">METHODS</span> get_global_authorizations <span class="kwd">FOR GLOBAL AUTHORIZATION</span>
      <span class="kwd">IMPORTING REQUEST</span> requested_authorizations <span class="kwd">FOR</span> ZIW_Products <span class="kwd">RESULT</span> result.

    <span class="kwd">METHODS</span> setCurrency <span class="kwd">FOR DETERMINE ON MODIFY</span>
      <span class="kwd">IMPORTING</span> keys <span class="kwd">FOR</span> ZIW_Products~setCurrency.

    <span class="kwd">METHODS</span> validatePrice <span class="kwd">FOR VALIDATE ON SAVE</span>
      <span class="kwd">IMPORTING</span> keys <span class="kwd">FOR</span> ZIW_Products~validatePrice.

    <span class="kwd">METHODS</span> applyDiscount <span class="kwd">FOR MODIFY</span>
      <span class="kwd">IMPORTING</span> keys <span class="kwd">FOR</span> ZIW_Products~applyDiscount <span class="kwd">RESULT</span> result.

    <span class="kwd">METHODS</span> early_numbering_create <span class="kwd">FOR NUMBERING</span>
      <span class="kwd">IMPORTING</span> entities <span class="kwd">FOR CREATE</span> ZIW_Products.
<span class="kwd">ENDCLASS</span>.

<span class="kwd">CLASS</span> lhc_ZIW_Products <span class="kwd">IMPLEMENTATION</span>.

  <span class="kwd">METHOD</span> get_global_authorizations.
  <span class="kwd">ENDMETHOD</span>.

  <span class="kwd">METHOD</span> setCurrency.
    <span class="kwd">READ ENTITIES OF</span> ZIW_Products <span class="kwd">IN LOCAL MODE</span>
      <span class="kwd">ENTITY</span> ZIW_Products
      <span class="kwd">FIELDS</span> ( prd_currency ) <span class="kwd">WITH CORRESPONDING</span> #( keys )
      <span class="kwd">RESULT DATA</span>(products).

    <span class="kwd">DELETE</span> products <span class="kwd">WHERE</span> prd_currency <span class="kwd">IS NOT INITIAL</span>.
    <span class="kwd">CHECK</span> products <span class="kwd">IS NOT INITIAL</span>.

    <span class="kwd">MODIFY ENTITIES OF</span> ZIW_Products <span class="kwd">IN LOCAL MODE</span>
      <span class="kwd">ENTITY</span> ZIW_Products
      <span class="kwd">UPDATE FIELDS</span> ( prd_currency )
      <span class="kwd">WITH VALUE</span> #( <span class="kwd">FOR</span> product <span class="kwd">IN</span> products
                    ( %tky = product-%tky
                      prd_currency = 'EUR' ) ).
  <span class="kwd">ENDMETHOD</span>.

  <span class="kwd">METHOD</span> validatePrice.
    <span class="kwd">READ ENTITIES OF</span> ZIW_Products <span class="kwd">IN LOCAL MODE</span>
      <span class="kwd">ENTITY</span> ZIW_Products
      <span class="kwd">FIELDS</span> ( prd_price ) <span class="kwd">WITH CORRESPONDING</span> #( keys )
      <span class="kwd">RESULT DATA</span>(products).

    <span class="kwd">LOOP AT</span> products <span class="kwd">INTO DATA</span>(product).
      <span class="kwd">IF</span> product-prd_price <= 0.
        <span class="kwd">APPEND VALUE</span> #( %tky = product-%tky ) <span class="kwd">TO</span> failed-ziw_products.
        <span class="kwd">APPEND VALUE</span> #( %tky = product-%tky
                        %msg = new_message_with_text(
                                 severity = if_abap_behv_message=>severity-error
                                 text     = 'Price must be greater than zero' )
                      ) <span class="kwd">TO</span> reported-ziw_products.
      <span class="kwd">ENDIF</span>.
    <span class="kwd">ENDLOOP</span>.
  <span class="kwd">ENDMETHOD</span>.

  <span class="kwd">METHOD</span> applyDiscount.
    <span class="kwd">READ ENTITIES OF</span> ZIW_Products <span class="kwd">IN LOCAL MODE</span>
      <span class="kwd">ENTITY</span> ZIW_Products
      <span class="kwd">FIELDS</span> ( prd_price ) <span class="kwd">WITH CORRESPONDING</span> #( keys )
      <span class="kwd">RESULT DATA</span>(products).

    <span class="kwd">LOOP AT</span> products <span class="kwd">ASSIGNING FIELD-SYMBOL</span>(&lt;product&gt;).
      &lt;product&gt;-prd_price = &lt;product&gt;-prd_price * '0.90'.
    <span class="kwd">ENDLOOP</span>.

    <span class="kwd">MODIFY ENTITIES OF</span> ZIW_Products <span class="kwd">IN LOCAL MODE</span>
      <span class="kwd">ENTITY</span> ZIW_Products
      <span class="kwd">UPDATE FIELDS</span> ( prd_price )
      <span class="kwd">WITH VALUE</span> #( <span class="kwd">FOR</span> product <span class="kwd">IN</span> products
                    ( %tky = product-%tky
                      prd_price = product-prd_price ) ).

    result = <span class="kwd">VALUE</span> #( <span class="kwd">FOR</span> product <span class="kwd">IN</span> products
                      ( %tky   = product-%tky
                        %param = product ) ).
  <span class="kwd">ENDMETHOD</span>.

  <span class="kwd">METHOD</span> early_numbering_create.
    <span class="kwd">SELECT MAX</span>( product_id ) <span class="kwd">FROM</span> zproduct_demo <span class="kwd">INTO @DATA</span>(max_id).
    <span class="kwd">IF</span> max_id <span class="kwd">IS INITIAL</span>.
      max_id = '100'.
    <span class="kwd">ENDIF</span>.

    <span class="kwd">LOOP AT</span> entities <span class="kwd">ASSIGNING FIELD-SYMBOL</span>(&lt;entity&gt;).
      max_id = max_id + 1.
      <span class="kwd">APPEND VALUE</span> #( %cid      = &lt;entity&gt;-%cid
                      %is_draft = &lt;entity&gt;-%is_draft
                      product_id = max_id ) <span class="kwd">TO</span> mapped-ziw_products.
    <span class="kwd">ENDLOOP</span>.
  <span class="kwd">ENDMETHOD</span>.
<span class="kwd">ENDCLASS</span>.</code></pre>
                </div>

                <div class="step-card">
                    <div class="step-title">4. Service Definition</div>
                    <pre><code><span class="com">@EndUserText.label: 'zui_products'</span>
<span class="kwd">define service</span> Zui_products {
  <span class="kwd">expose</span> ZIW_Products;
  <span class="kwd">expose</span> I_Currency;
}</code></pre>
                </div>
            </section>

            <section id="outcome">
                <h2>12. Final Outcome</h2>
                <div class="concept-box">
                    <div class="concept-title">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Congratulations!
                    </div>
                    <p>You have built a complete <strong>Fiori Elements</strong> application backed by a robust
                        <strong>RAP Business Object</strong>.</p>
                    <ul>
                        <li><strong>UI:</strong> Fully responsive List Report and Object Page.</li>
                        <li><strong>Behavior:</strong> Full CRUD with Draft support.</li>
                        <li><strong>Automation:</strong> Auto-generated IDs and default values.</li>
                        <li><strong>Logic:</strong> Business validations and custom actions.</li>
                    </ul>
                    <p>This is the foundation of modern SAP development on S/4HANA and BTP.</p>
                </div>
            </section>

            <footer
                style="margin-top: 80px; padding-top: 40px; border-top: 1px solid var(--border); text-align: center; color: var(--text-light);">
                Created by <strong style="color: var(--primary);">Racem Ben Amar</strong>, SAP Technical Consultant
            </footer>

        </div>
    </main>

    <script>
        // Simple active state for sidebar
        const navItems = document.querySelectorAll('.nav-item');
        navItems.forEach(item => {
            item.addEventListener('click', () => {
                navItems.forEach(n => n.classList.remove('active'));
                item.classList.add('active');
            });
        });
    </script>

</body>

</html>